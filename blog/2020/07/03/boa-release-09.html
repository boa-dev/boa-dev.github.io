<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Boa v0.9: measureme &amp; optimisations | Boa JS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://boajs.dev/img/new_logo_yellow.svg"><meta data-rh="true" name="twitter:image" content="https://boajs.dev/img/new_logo_yellow.svg"><meta data-rh="true" property="og:url" content="https://boajs.dev/blog/2020/07/03/boa-release-09"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Boa v0.9: measureme &amp; optimisations | Boa JS"><meta data-rh="true" name="description" content="Hello World!"><meta data-rh="true" property="og:description" content="Hello World!"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-07-03T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/boa-dev"><meta data-rh="true" property="article:tag" content="post"><link data-rh="true" rel="icon" href="/img/new_logo_yellow.svg"><link data-rh="true" rel="canonical" href="https://boajs.dev/blog/2020/07/03/boa-release-09"><link data-rh="true" rel="alternate" href="https://boajs.dev/blog/2020/07/03/boa-release-09" hreflang="en"><link data-rh="true" rel="alternate" href="https://boajs.dev/blog/2020/07/03/boa-release-09" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://boajs.dev/blog/2020/07/03/boa-release-09","mainEntityOfPage":"https://boajs.dev/blog/2020/07/03/boa-release-09","url":"https://boajs.dev/blog/2020/07/03/boa-release-09","headline":"Boa v0.9: measureme & optimisations","name":"Boa v0.9: measureme & optimisations","description":"Hello World!","datePublished":"2020-07-03T00:00:00.000Z","author":{"@type":"Person","name":"Boa Developers","url":"https://github.com/boa-dev"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://boajs.dev/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Boa JS RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Boa JS Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Boa JS JSON Feed"><link rel="stylesheet" href="/assets/css/styles.062cb03f.css">
<script src="/assets/js/runtime~main.7fd872d0.js" defer="defer"></script>
<script src="/assets/js/main.e63ad481.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/new_logo_blue.svg"><link rel="preload" as="image" href="/img/new_logo_yellow.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/new_logo_blue.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/new_logo_yellow.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Boa</b></a><a class="navbar__item navbar__link" href="/docs/intro">Learn More</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/playground">Playground</a><a class="navbar__item navbar__link" href="/conformance">Conformance</a><a class="navbar__item navbar__link" href="/benchmarks">Benchmarks</a><a href="https://docs.rs/boa_engine/latest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/boa-dev/boa" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/03/05/local-variables">How ECMAScript Engines Optimize Your Variables</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/12/05/boa-release-020">Boa release v0.20</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/07/09/boa-release-19">Boa release v0.19</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/03/07/boa-release-18">Boa release v0.18</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/08/boa-release-17">Boa release v0.17</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/24/boa-usage">Adding a JavaScript interpreter to your Rust project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/25/boa-release-16">Boa release v0.16</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/10/boa-release-15">Boa release v0.15</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/15/boa-release-14">Boa release v0.14</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/30/boa-release-13">Boa release v0.13</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/07/boa-release-12">Boa release v0.12</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/14/boa-release-11">Boa release v0.11</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/10/02/boa-release-10">Boa release v0.10</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2020/07/03/boa-release-09">Boa v0.9: measureme &amp; optimisations</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Boa v0.9: measureme &amp; optimisations</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-07-03T00:00:00.000Z">July 3, 2020</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/boa-dev" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Boa Developers</span></a></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Hello World!</p>
<p>Boa is an experimental Javascript lexer, parser and compiler written in Rust. It has support for some of the language, can be embedded in Rust projects fairly easily and also used from the command line.<br>
<!-- -->Boa also exists to serve as a Rust implementation of the EcmaScript specification, there will be areas where we can utilise Rust and its fantastic ecosystem to make a fast, concurrent and safe engine.</p>
<p>Today we&#x27;re pleased to announce our latest release, version 0.9.<br>
<!-- -->v0.9 is by far the biggest release we&#x27;ve had since Boa began. You can find the full changes from the <a href="https://github.com/boa-dev/boa/blob/main/CHANGELOG.md#-090-2020-06-25---move-to-organisation-78-faster-execution-time" target="_blank" rel="noopener noreferrer">changelog</a>. The milestone behind this version was further optimisation and an increase in new features. We can show you how we can identify areas that can be optimised.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="better-tooling-for-profiling">Better tooling for profiling<a href="#better-tooling-for-profiling" class="hash-link" aria-label="Direct link to Better tooling for profiling" title="Direct link to Better tooling for profiling">​</a></h2>
<p>Boa became the first Rust project to make use of <a href="https://github.com/rust-lang/measureme" target="_blank" rel="noopener noreferrer">measureme</a>, a profiling tool built from the ground up for Rust. This was only used by the Rust team themselves to profile the compiler. We managed to work with the compiler team to get the framework in a good enough state to be used by other projects too, and in this release, we gave it a try.</p>
<p>Measure me lets you profile various areas of your choosing, then you can generate a trace file which can be loaded into Chromium or various other tools for analysis.
We took it for a spin (which you&#x27;ll see in Object Specialization).</p>
<p>Below is an example of our trace, this is using a measureme tool called <code>summarize</code></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+-----------+-----------------+----------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Item                       | Self time | % of total time | Time     | Item count |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+-----------+-----------------+----------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| From&lt;Object&gt;               | 1.04ms    | 14.776          | 1.04ms   | 146        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+-----------+-----------------+----------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| new_object                 | 356.50µs  | 5.082           | 533.50µs | 18         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+-----------+-----------------+----------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| create_instrinsics         | 263.50µs  | 3.756           | 6.38ms   | 1          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+-----------+-----------------+----------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| make_builtin_fn: toString  | 218.50µs  | 3.114           | 290.50µs | 12         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+-----------+-----------------+----------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| String                     | 81.60µs   | 1.163           | 961.60µs | 1          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+-----------+-----------------+----------+------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can read more about Rust&#x27;s usage of measureme <a href="https://blog.rust-lang.org/inside-rust/2020/02/25/intro-rustc-self-profile.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="object-specialization">Object Specialization<a href="#object-specialization" class="hash-link" aria-label="Direct link to Object Specialization" title="Direct link to Object Specialization">​</a></h2>
<p>In JavaScript internal metadata for objects are stored in <code>internal slots</code>. In Boa we stored internal slots as a hashmap tied to the object, with the keys being strings and the values as <a href="https://github.com/boa-dev/boa/blob/73f65f7800917c92f86134eaa21751c1ca93d986/boa/src/builtins/value/mod.rs#L57-L78" target="_blank" rel="noopener noreferrer"><code>JSValues</code></a>. This meant we needed to constantly unwrap them into a Rust primitive to access the data. Secondly we were restricted as to what type of data we could put in internal slots. For example, lets say we want to implement <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set" target="_blank" rel="noopener noreferrer"><code>Set</code></a> by using the native <a href="https://doc.rust-lang.org/std/collections/struct.HashSet.html" target="_blank" rel="noopener noreferrer"><code>HashSet</code></a> as a backing store, this would not be possible.</p>
<p>By changing how internal data is handled for some of our builtin objects and removing a whole bunch of redundant access checks, we managed to speed up the interpreter.</p>
<p>Boa would spend a significant amount of time converting back and forth between JS Values and primitive values. We found a huge amount of time was spent in <code>Value::set_field</code> before any code had even been executed. <code>set_field</code> was slow due to the amount of updating of internal slots as part of setting up. Here you can see realm creation takes roughly 60ms (dev build).</p>
<p><em>We use <a href="https://github.com/rust-lang/measureme/blob/main/crox/Readme.md" target="_blank" rel="noopener noreferrer">Crox</a> to convert our measureme data into a format Chrome&#x27;s performance tab understands</em></p>
<p><img decoding="async" loading="lazy" alt="Before" src="/assets/images/before-b541b61e85c78e35de4900cda09fae1c.png" width="1279" height="1002" class="img_ev3q"></p>
<p>We refactored many builtins to hold an <code>ObjectData</code> enum variant instead, some of which can hold a value for the type also.
This can be used to both identify objects and to use their internal data.<br>
<!-- -->Here is an example of our enum.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Defines the different types of objects.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(Debug, Trace, Finalize, Clone)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token type-definition class-name">ObjectData</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">BigInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RcBigInt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Boolean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Function</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RcString</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Number</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">f64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Symbol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">RcSymbol</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Ordinary</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="After" src="/assets/images/after-114754df50c9a05fc0eec4fabcac2bd0.png" width="1280" height="1005" class="img_ev3q"></p>
<p>This gave us a 70% speedup and reduced startup time by well over half. The <code>realm::create</code> function now runs in 13ms instead of 60ms.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimised-type-comparisons">Optimised Type Comparisons<a href="#optimised-type-comparisons" class="hash-link" aria-label="Direct link to Optimised Type Comparisons" title="Direct link to Optimised Type Comparisons">​</a></h2>
<p>If you&#x27;ve ever called <code>typeof</code> in JavaScript, you get a string value describing the primitive type of it&#x27;s argument. Boa was doing the same internally for comparing (using the &quot;get_type()&quot; call), however getting the string value from each primitive then comparing them is not very performant.<br>
<!-- -->Now, thanks to @Lan2u we have a rust <a href="https://github.com/boa-dev/boa/blob/8f8498eac17164c8de2f599bd0b7ba2e8053ec30/boa/src/builtins/value/val_type.rs#L4-L17" target="_blank" rel="noopener noreferrer"><code>Type</code></a> enum which makes comparing more efficient and on average brings another 8% performance boost.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="jsvalue-refactor">JSValue Refactor<a href="#jsvalue-refactor" class="hash-link" aria-label="Direct link to JSValue Refactor" title="Direct link to JSValue Refactor">​</a></h2>
<p>We have completely refactored how JavaScript values are stored.<br>
<a href="https://github.com/boa-dev/boa/pull/498" target="_blank" rel="noopener noreferrer">#498</a> makes values more lightweight by only GC&#x27;ing objects and not the primitives. The primitive scalar values are just Rust primitives which implement the Copy trait, so the overhead of moving these around is much lower.<br>
<!-- -->By decoupling our <code>Value</code> types and <code>GC</code> types we have brought our <code>Value</code> size from 40 bytes =&gt; 24 bytes and an 80% reduction in arithmetic operations!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="parser-rebuild-better-code-organisation">Parser rebuild, better code organisation<a href="#parser-rebuild-better-code-organisation" class="hash-link" aria-label="Direct link to Parser rebuild, better code organisation" title="Direct link to Parser rebuild, better code organisation">​</a></h2>
<p>Boa was predominantly 3 files. The lexer, parser and interpreter.<br>
<!-- -->The naive implementation of the parser was a <a href="https://github.com/boa-dev/boa/blob/c23a7b1f4ac57af6c5f0b9f6c98fbbed7a14c98f/src/lib/syntax/parser.rs" target="_blank" rel="noopener noreferrer">single file</a> which had a long match expression for tokens and went through every token figuring out what to do. This did the job but became unmaintainable when adding new features.<br>
<!-- -->We have been breaking the parser up into separate modules, which represent various expressions and statements that conform to the specification. (more about this in a future post).</p>
<p>After all the fixes in this release we&#x27;ve seen on average a 70% improvement, we still have areas where we plan to improve. We are currently rebuilding the lexer so it is more broken up like the parser and interpreter, we will blog about this soon in future.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="roadmap">Roadmap<a href="#roadmap" class="hash-link" aria-label="Direct link to Roadmap" title="Direct link to Roadmap">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-much-of-the-specification-is-covered"><em>How much of the specification is covered?</em><a href="#how-much-of-the-specification-is-covered" class="hash-link" aria-label="Direct link to how-much-of-the-specification-is-covered" title="Direct link to how-much-of-the-specification-is-covered">​</a></h3>
<p>Our next milestone is to tidy up the lexer so it takes into account <a href="https://tc39.es/ecma262/#sec-context-free-grammars" target="_blank" rel="noopener noreferrer"><code>goal symbols</code></a> then we plan to start running Test 262, the official ECMAScript Test Suite. It has a lot of tests (over 29272 test files) and will tell us in detail which parts of the specification need work.<br>
<!-- -->There are also large items like classes which are still not covered, however, these should now be easier to implement with parsing broken up.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="public-api"><em>Public API</em><a href="#public-api" class="hash-link" aria-label="Direct link to public-api" title="Direct link to public-api">​</a></h3>
<p><a href="https://github.com/boa-dev/boa/issues/445" target="_blank" rel="noopener noreferrer">#445</a> looks to improve the public API too so Rust projects can interactive with Boa more easily.<br>
<!-- -->It should be possible today to just use the lexer, parser or the whole execution path.</p>
<p>We hope to add more detail in future on how some parts of Boa work, make sure you stay tuned for any future posts!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/post">post</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2020/10/02/boa-release-10"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Boa release v0.10</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#better-tooling-for-profiling" class="table-of-contents__link toc-highlight">Better tooling for profiling</a></li><li><a href="#object-specialization" class="table-of-contents__link toc-highlight">Object Specialization</a></li><li><a href="#optimised-type-comparisons" class="table-of-contents__link toc-highlight">Optimised Type Comparisons</a></li><li><a href="#jsvalue-refactor" class="table-of-contents__link toc-highlight">JSValue Refactor</a></li><li><a href="#parser-rebuild-better-code-organisation" class="table-of-contents__link toc-highlight">Parser rebuild, better code organisation</a></li><li><a href="#roadmap" class="table-of-contents__link toc-highlight">Roadmap</a><ul><li><a href="#how-much-of-the-specification-is-covered" class="table-of-contents__link toc-highlight"><em>How much of the specification is covered?</em></a></li><li><a href="#public-api" class="table-of-contents__link toc-highlight"><em>Public API</em></a></li></ul></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Learn More</a></li><li class="footer__item"><a href="https://docs.rs/boa_engine/latest" target="_blank" rel="noopener noreferrer" class="footer__link-item">API Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/tUFFk9Y" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://fosstodon.org/@boa_engine" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mastodon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://boajs.dev/blog/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/boa-dev/boa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>