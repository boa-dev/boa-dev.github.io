"use strict";(self.webpackChunkboajs_dev=self.webpackChunkboajs_dev||[]).push([[9797],{4960:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=s(4848),t=s(8453);const r={sidebar_position:7},o="Profiling",a={id:"profiling",title:"Profiling",description:"Example",source:"@site/docs/profiling.md",sourceDirName:".",slug:"/profiling",permalink:"/docs/profiling",draft:!1,unlisted:!1,editUrl:"https://github.com/boa-dev/boa-dev.github.io/tree/main/docs/docs/profiling.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"infoSidebar",previous:{title:"Shapes (Hidden Classes)",permalink:"/docs/optimizations/shapes"},next:{title:"Resources",permalink:"/docs/resources"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"How To Use",id:"how-to-use",level:2},{value:"Summarize",id:"summarize",level:3},{value:"More Information",id:"more-information",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"profiling",children:"Profiling"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Example",src:s(3265).A+"",width:"3133",height:"766"})}),"\n",(0,i.jsx)(n.p,{children:"It's possible to get a full profile of Boa in action.\nSometimes this is needed to figure out where it is spending most of it's time."}),"\n",(0,i.jsxs)(n.p,{children:["We use a crate called ",(0,i.jsx)(n.a,{href:"https://github.com/rust-lang/measureme",children:"measureme"}),", which helps us keep track of timing functions during runtime."]}),"\n",(0,i.jsx)(n.p,{children:'When the "profiler" flag is enabled, you compile with the profiler and it is called throughout the interpreter.\nwhen the feature flag is not enabled, you have an empty dummy implementation that is just no ops. rustc should completely optimize that away. So there should be no performance downgrade from these changes'}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before continuing, please make sure the below prerequisites have been met."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/rust-lang/measureme/blob/master/crox/README.md",children:"Crox"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/rust-lang/measureme/blob/master/summarize/README.md",children:"summarize (Optional)"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-use",children:"How To Use"}),"\n",(0,i.jsx)(n.p,{children:'You can run boa using the "profiler" feature flag to enable profiling. Seeing as you\'ll most likely be using boa_cli you can pass this through, like so:'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"cargo run --release --features boa_engine/profiler ../tests/js/test.js"})}),"\n",(0,i.jsxs)(n.p,{children:["Once finished you should see some trace files left in the directory (boa_cli in this case).\nIn the same directory as the ",(0,i.jsx)(n.code,{children:".events, string_data, string_index"})," files run ",(0,i.jsx)(n.code,{children:"crox my_trace"})," or whatever the name of the files are. This will generate a chrome_profiler.json file, you can load this into Chrome Dev tools."]}),"\n",(0,i.jsx)(n.h3,{id:"summarize",children:"Summarize"}),"\n",(0,i.jsxs)(n.p,{children:["If you just want a summary of what functions were ran the most or where the most time was spent you can run ",(0,i.jsx)(n.code,{children:"summarize"}),".\nThis is the same as above except instead of calling ",(0,i.jsx)(n.code,{children:"$ crox my_trace"})," you call ",(0,i.jsx)(n.code,{children:"$ summarize summarize my_trace"}),". This will generate something like below:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-md",children:"+---------------------------------------+-----------+-----------------+----------+------------+\n| Item | Self time | % of total time | Time | Item count |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| From<Object> | 1.04ms | 14.776 | 1.04ms | 146 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| new_object | 356.50\xb5s | 5.082 | 533.50\xb5s | 18 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| create_instrinsics | 263.50\xb5s | 3.756 | 6.38ms | 1 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| make_builtin_fn: toString | 218.50\xb5s | 3.114 | 290.50\xb5s | 12 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| Value::get_field | 178.60\xb5s | 2.546 | 340.20\xb5s | 60 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| Value::get_property | 161.60\xb5s | 2.303 | 161.60\xb5s | 60 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| lex | 135.60\xb5s | 1.933 | 135.60\xb5s | 1 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| math:create | 125.40\xb5s | 1.787 | 1.11ms | 1 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| Value::set_field | 100.20\xb5s | 1.428 | 262.80\xb5s | 8 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| function::builtin | 82.40\xb5s | 1.175 | 82.40\xb5s | 146 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n| String | 81.60\xb5s | 1.163 | 961.60\xb5s | 1 |\n+---------------------------------------+-----------+-----------------+----------+------------+\n"})}),"\n",(0,i.jsx)(n.h2,{id:"more-information",children:"More Information"}),"\n",(0,i.jsxs)(n.p,{children:["For more information, please see the ",(0,i.jsx)(n.a,{href:"./resources#profiling",children:"profiling resources"})]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},3265:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/profiler-1f1dba01fd288dcff446cc6a3cb42038.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);